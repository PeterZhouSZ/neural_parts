import numpy as np

from simple_3dviz import Mesh


def scene_init(mesh, up_vector, camera_position, camera_target, background):
    def inner(scene):
        scene.background = background
        scene.up_vector = up_vector
        scene.camera_position = camera_position
        scene.camera_target = camera_target
        if mesh is not None:
            scene.add(mesh)
    return inner


def load_ground_truth(dataset):
    mesh = dataset.internal_dataset_object[0].groundtruth_mesh
    N = len(mesh.vertices)
    return Mesh.from_faces(
        mesh.vertices,
        mesh.faces,
        (0.8, 0.8, 0.8, 0.3)
    )


def get_colors(i):
    colors = [
       (0.74117647, 0.77647059, 1., 1.),
       (0.74509804, 0.6, 0.43921569, 1.),
       (0.83529412, 1., 0., 1.),
       (0.61960784, 0., 0.55686275, 1.),
       (0.59607843, 1., 0.32156863, 1.),
       (0.46666667, 0.30196078, 0., 1.),
       (0.47843137, 0.27843137, 0.50980392, 1.),
       (0., 0.68235294, 0.49411765, 1.),
       (0., 0.49019608, 0.70980392, 1.),
       (0.90980392, 0.36862745, 0.74509804, 1.),
       (0., 0.56078431, 0.61176471, 1.),
       (0.41960784, 0.40784314, 0.50980392, 1.),
       (1., 0.89803922, 0.00784314, 1.),
       (0.00392157, 1., 0.99607843, 1.),
       (1., 0.65098039, 0.99607843, 1.),
       (0., 0.39215686, 0.00392157, 1.),
       (0.73333333, 0.53333333, 0., 1.),
       (1., 0.85882353, 0.4, 1.),
       (0.52156863, 0.6627451, 0., 1.),
       (0.58431373, 0., 0.22745098, 1.),
       (0., 0.4627451, 1., 1.),
       (0.45882353, 0.26666667, 0.69411765, 1.),
       (0., 0.08235294, 0.26666667, 1.),
       (0.76078431, 0.54901961, 0.62352941, 1.),
       (0.38431373, 0.05490196, 0., 1.),
       (0., 0.27843137, 0.32941176, 1.),
       (0.2627451, 0., 0.17254902, 1.),
       (0.00392157, 0.81568627, 1., 1.),
       (0.56862745, 0.81568627, 0.79607843, 1.),
       (1., 0.57647059, 0.49411765, 1.),
       (0.37254902, 0.67843137, 0.30588235, 1.),
       (1., 0.93333333, 0.90980392, 1.),
       (0., 0.60784314, 1., 1.),
       (1., 0., 0.3372549, 1.),
       (0.74117647, 0.82745098, 0.57647059, 1.),
       (0.74117647, 0.82745098, 0.57647059, 1.),
       (1., 0.00784314, 0.61568627, 1.),
       (0., 0.7254902, 0.09019608, 1.),
       (0., 0., 1., 1.),
       (1., 0., 0.96470588, 1.),
       (0.00392157, 0., 0.40392157, 1.),
    ]
    return colors[i % len(colors)]


def jet(x):
    red = np.interp(x, [0, 0.5, 1], [0, 0, 1.])
    green = np.interp(x, [0, 0.5, 1], [0, 1., 0.])
    blue = np.interp(x, [0, 0.5, 1], [1., 0, 0.])

    return np.array([red, green, blue]).T


def colormap(x, name="hsv", lut=200):
    from matplotlib import cm
    cmap = cm.get_cmap(name, lut)
    return cmap(x)[:, :3]
